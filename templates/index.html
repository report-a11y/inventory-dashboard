<!DOCTYPE html>
<html>
<head>
<title>Premium Inventory Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@media (max-width:900px){

    .main-layout{
        flex-direction:column;
    }

    .sidebar{
        width:100%;
        position:relative;
        height:auto;
    }
}

body{
    margin:0;
    font-family:Segoe UI;
    background:#0f0f0f;
    color:white;
    overflow-x:hidden;
}

.header{
    padding:15px;
    background:#1a1a1a;
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    align-items:center;

    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
}

/* HEADER already sticky hona chahiye */

.summary {
    display:flex;
    gap:20px;
    padding:20px;
    flex-wrap:wrap;

    position: sticky;
    top: 80px; /* header height ke according adjust */
    z-index: 900;

    backdrop-filter: blur(10px);
    background: rgba(15,15,15,0.85);
    border-bottom: 1px solid #222;
}

.header input{ flex:1 1 220px; min-width:180px; }
.header select{ flex:1 1 160px; min-width:140px; }
.header button{ flex:0 0 auto; min-width:100px; }

select,input,button{
    padding:10px;
    border-radius:8px;
    border:none;
}

button{
    background:#00c6ff;
    font-weight:bold;
    cursor:pointer;
}

@media (max-width:768px){
    .header input{ flex:1 1 100%; }
    .header select{ flex:1 1 calc(50% - 6px); }
    .header button{ flex:1 1 100%; }
}
/* MAIN LAYOUT */
.main-layout{
    display:flex;
    gap:40px;          /* pehle 20 tha â€” ab zyada space */
    padding:30px;      /* overall breathing space */
}

/* LEFT PANEL */
.sidebar{
    width:320px;
    min-width:280px;
    position: sticky;
    top:100px;
    height:calc(100vh - 120px);
    overflow-y:auto;

    background:#141414;
    border-radius:20px;
    padding:20px;
    border:1px solid #222;
}

/* RIGHT CONTENT */
.content{
    flex:1;
    margin-left:20px;
}

/* SIDEBAR TOP CARDS */
.sidebar-top-summary{
    display:flex;
    flex-direction:column;
    gap:15px;
    margin-bottom:30px;
}

.side-card{
    background:linear-gradient(145deg,#1c1c1c,#111);
    padding:18px;
    border-radius:14px;
    border:1px solid #222;
    transition:0.3s ease;
}

.side-card:hover{
    border-color:#00ffcc;
    box-shadow:0 0 20px rgba(0,255,204,0.2);
}

.side-card h3{
    font-size:12px;
    color:#00c6ff;
    text-transform:uppercase;
    margin:0;
    letter-spacing:1px;
}

.side-card h2{
    margin-top:8px;
    font-size:22px;
    color:#00ffcc;
}

/* PRODUCTS GRID */
.products{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:25px;
    margin-top:10px;   /* yeh add karo */
}



.card:hover{
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,255,204,0.1);
}

.card h3{
    color:#00c6ff;
    font-size:14px;
    letter-spacing:1px;
    text-transform:uppercase;
    opacity:0.8;
}

.card h2{
    font-size:28px;
    margin-top:10px;
    color:#00ffcc;
}

.card h3{
    color:#00c6ff;
    margin:0;
}

#live-summary{ padding:20px; }

.summary-box{
    background: linear-gradient(145deg,#1a1a1a,#121212);
    padding:25px;
    border-radius:20px;
    margin-bottom:30px;
    border:1px solid #222;
    position:relative;
    overflow:hidden;
}

.summary-title{
    color:#00c6ff;
    font-size:16px;
    font-weight:600;
    margin-bottom:20px;
    letter-spacing:1px;
}

.summary-title{
    color:#00c6ff;
    margin-bottom:15px;
}

.summary-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
    gap:15px;
}

.summary-item{
    background: linear-gradient(145deg,#151515,#101010);
    padding:18px;
    border-radius:14px;
    text-align:center;
    border:1px solid #222;
    transition:0.3s ease;
    cursor:pointer;
}

.summary-item:hover{
    transform: scale(1.05);
    border-color:#00ffcc;
    box-shadow: 0 0 20px rgba(0,255,204,0.2);
}

.summary-item h4{
    margin:0;
    font-size:13px;
    color:#aaa;
    letter-spacing:1px;
}

.summary-item p{
    margin-top:8px;
    font-size:20px;
    font-weight:bold;
    color:#00ffcc;
}

.summary-item h4{
    margin:0;
    font-size:14px;
    color:#aaa;
}

.summary-item p{
    margin:5px 0 0;
    font-size:18px;
    font-weight:bold;
    color:#00ffcc;
}

.products{
    padding:20px;
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:25px;
}

.product{
    background:#1a1a1a;
    border-radius:16px;
    overflow:hidden;
}

.product.low-stock{
    border:2px solid red;
}

.product-img{
    width:100%;
    aspect-ratio:4/5;
    object-fit:cover;
}

.product-info{ padding:15px; }

.price{
    color:#00ffcc;
    font-weight:bold;
}

.modal{
    display:none;
    position:fixed;
    left:0;
    top:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
}

.modal img{
    max-width:80%;
    max-height:80%;
}

/* MAIN LAYOUT */
.main-layout{
    display:flex;
    gap:20px;
    padding:20px;
}

/* LEFT SUMMARY PANEL */
.sidebar{
    width:300px;
    min-width:260px;
    max-height:calc(100vh - 160px);
    overflow-y:auto;

    position: sticky;
    top:120px;
    margin-right:10px;


    background:#141414;
    padding:20px;
    border-radius:18px;
    border:1px solid #222;
}

/* RIGHT CONTENT */
.content{
    flex:1;
    margin-left:20px;
}
/* Products grid */
.products{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:25px;
}

@media (max-width:900px){

    .main-layout{
        flex-direction:column;
    }

    .sidebar{
        width:100%;
        position:relative;
        top:0;
        max-height:none;
    }
}
.sidebar::-webkit-scrollbar{
    width:6px;
}

.sidebar::-webkit-scrollbar-thumb{
    background:#00ffcc;
    border-radius:10px;
}

/* IMAGE ZOOM MODAL */
.image-modal{
    display:none;
    position:fixed;
    z-index:9999;
    padding-top:60px;
    left:0;
    top:0;
    width:100%;
    height:100%;
    overflow:auto;
    background:rgba(0,0,0,0.95);
    backdrop-filter: blur(6px);
    animation: fadeIn 0.3s ease;
}

.modal-content{
    margin:auto;
    display:block;
    max-width:80%;
    max-height:80%;
    border-radius:20px;
    box-shadow:0 0 40px rgba(0,255,204,0.3);
    animation: zoomIn 0.3s ease;
}

.close-btn{
    position:absolute;
    top:20px;
    right:35px;
    color:#00ffcc;
    font-size:40px;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
}

.close-btn:hover{
    color:white;
}

@keyframes zoomIn{
    from{ transform:scale(0.6); opacity:0; }
    to{ transform:scale(1); opacity:1; }
}

@keyframes fadeIn{
    from{ opacity:0; }
    to{ opacity:1; }
}




</style>
</head>

<body>

<div class="header">
<input type="text" id="search" placeholder="Search...">

<select id="article"><option value="">All Articles</option></select>
<select id="colour"><option value="">All Colours</option></select>
<select id="size"><option value="">All Sizes</option></select>
<select id="section"><option value="">All Sections</option></select>
<select id="location"><option value="">All Locations</option></select>

<button onclick="resetFilters()">Reset</button>
</div>

<div class="main-layout">

    <div class="sidebar">

        <!-- TOP SUMMARY CARDS -->
        <div class="sidebar-top-summary">
            <div class="side-card">
                <h3>Total Stock</h3>
                <h2 id="total_stock"></h2>
            </div>

            <div class="side-card">
                <h3>Total Value</h3>
                <h2 id="total_value"></h2>
            </div>

            <div class="side-card">
                <h3>Total Articles</h3>
                <h2 id="total_articles"></h2>
            </div>
        </div>

        <!-- CATEGORY + SIZE -->
        <div id="live-summary"></div>

    </div>

    <div class="content">
        <div class="products" id="products"></div>
    </div>

</div>
<div id="pagination" style="text-align:center;padding:20px;"></div>

<div class="image-modal" id="imageModal">
    <span class="close-btn" id="closeModal">&times;</span>
    <img class="modal-content" id="zoomImage">
</div>

<script>

async function loadData(params="") {

    try {
        const res = await fetch("/filter" + (params || "?page=1"));
        const response = await res.json();

        render(response);

        // âœ… DROPDOWNS LOAD HERE (CORRECT PLACE)
        populateDropdown("article", response.articles || []);
        populateDropdown("colour", response.colours || []);
        populateDropdown("size", response.sizes || []);
        populateDropdown("section", response.sections || []);
        populateDropdown("location", response.locations || []);

    } catch (error) {
        console.error("Fetch Error:", error);
    }
}

function render(response){

    document.getElementById("total_stock").innerText = response.total_stock || 0;
    document.getElementById("total_value").innerText = "â‚¹ " + (response.total_value || 0);
    document.getElementById("total_articles").innerText = response.total_articles || 0;

    renderLiveSummary(response.category_summary || {}, response.size_summary || {});

    const container = document.getElementById("products");
    container.innerHTML = "";

    if(!response.data || response.data.length === 0){
        container.innerHTML = "<h2 style='padding:20px'>No Data Found</h2>";
        return;
    }

    const grouped = {};

    response.data.forEach(row => {

        const key = row.article + "_" + row.colour;

        if(!grouped[key]){
            grouped[key] = {
                article: row.article,
                colour: row.colour,
                section: row.section,
                location: row.location,
                image: row.image,
                value: row.value,
                sizes: {}
            };
        }

        if(!grouped[key].sizes[row.size]){
            grouped[key].sizes[row.size] = 0;
        }

        grouped[key].sizes[row.size] += row.total;
    });

    Object.values(grouped).forEach(item => {

        let sizeHtml = "";

        for(let s in item.sizes){
            sizeHtml += `<p>${s} : ${item.sizes[s]}</p>`;
        }

        const div = document.createElement("div");
        div.className = "product";

        div.innerHTML = `
            <img src="${item.image || 'https://via.placeholder.com/400'}"
                 class="product-img"
                 onerror="this.src='https://via.placeholder.com/400'">
            <div class="product-info">
                <h3>${item.article}</h3>
                <p>${item.colour}</p>
                <p>${item.section}</p>
                <p>Location: ${item.location}</p>
                <div style="margin-top:10px">
                    <strong>Sizes:</strong>
                    ${sizeHtml}
                </div>
                <p class="price">â‚¹ ${item.value}</p>
            </div>
        `;

        container.appendChild(div);
        enableImageZoom();
        renderPagination(response.page || 1, response.total_pages || 1);
    });
}

function renderLiveSummary(categoryData, sizeData){

    let html = "";

    html += `
    <div class="summary-box">
        <div class="summary-title">Category Wise Stock</div>
        <div class="summary-grid">`;

    for(let cat in categoryData){
        html += `<div class="summary-item"><h4>${cat}</h4><p>${categoryData[cat]}</p></div>`;
    }

    html += `</div></div>`;

    html += `
    <div class="summary-box">
        <div class="summary-title">Size Wise Stock</div>
        <div class="summary-grid">`;

    for(let size in sizeData){
        html += `<div class="summary-item"><h4>${size}</h4><p>${sizeData[size]}</p></div>`;
    }

    html += `</div></div>`;

    document.getElementById("live-summary").innerHTML = html;
}

function populateDropdown(id, items){

    const select = document.getElementById(id);

    select.innerHTML = `<option value="">All ${id.charAt(0).toUpperCase() + id.slice(1)}s</option>`;

    items.forEach(item => {
        const option = document.createElement("option");
        option.value = item;
        option.textContent = item;
        select.appendChild(option);
    });
}

function applyFilters(){

    const params = new URLSearchParams();

    ["article","colour","size","section","location"].forEach(id => {
        const val = document.getElementById(id).value;
        if(val) params.append(id, val);
    });

    const search = document.getElementById("search").value;
    if(search) params.append("search", search);

    loadData("?" + params.toString());
}

function resetFilters(){
    document.querySelectorAll("select").forEach(s => s.value = "");
    document.getElementById("search").value="";
    loadData();
}

document.querySelectorAll("select").forEach(s =>
    s.addEventListener("change", applyFilters)
);

document.getElementById("search")
    .addEventListener("input", applyFilters);

loadData();

function renderPagination(currentPage, totalPages){

    let html = "";

    for(let i=1; i<=totalPages; i++){
        html += `
            <button onclick="loadData('?page=${i}')"
                style="
                    margin:5px;
                    padding:8px 12px;
                    background:${i===currentPage ? '#00c6ff' : '#222'};
                    color:white;
                    border:none;
                    border-radius:6px;
                    cursor:pointer;
                ">
                ${i}
            </button>
        `;
    }

    document.getElementById("pagination").innerHTML = html;
}

// IMAGE ZOOM
function enableImageZoom(){

    document.querySelectorAll(".product-img").forEach(img => {

        img.addEventListener("click", function(){

            const modal = document.getElementById("imageModal");
            const zoomImg = document.getElementById("zoomImage");

            modal.style.display = "block";
            zoomImg.src = this.src;
        });

    });

}

// Close modal
document.getElementById("closeModal").onclick = function(){
    document.getElementById("imageModal").style.display = "none";
};

// Close on outside click
window.onclick = function(event){
    const modal = document.getElementById("imageModal");
    if(event.target == modal){
        modal.style.display = "none";
    }
};


</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

<script>
    const socket = io();

    socket.on("data_updated", function() {
        console.log("Live Update Received ðŸš€");
        loadData();   // your existing function
    });
</script>

</body>
</html>